# 南信州地域イベント情報集約サービス 要件定義書

**作成日**: 2025 年 11 月 3 日  
**バージョン**: 1.0  
**プロジェクト名**: （仮）南信州イベントポータル

---

## 1. プロジェクト概要

### 1.1 背景と課題

南信州地域（飯田市中心）では、イベント情報が「役場の紙」「公民館掲示板」「自治会回覧板」「Facebook」「LINE グループ」「商工会」「学校 PTA」など複数の媒体に散在しており、住民が地域のイベント情報を把握することが困難な状況にある。

**主な課題**：

- 情報源が分散していて、結局知らないまま終わるイベントが多い
- 行ったら楽しいイベントでも、存在に気づけない
- 地方では「人に言われて初めて知る」文化があり、能動的な情報収集が根付いていない

### 1.2 サービスコンセプト

「**探さなくていい状態**」を作ることで、地域住民が簡単にイベント情報にアクセスできる環境を提供する。

### 1.3 期待される効果

- 地域イベントへの参加者増加
- 地域活性化への貢献
- 情報格差の解消（特に高齢者・子育て世代への支援）

---

## 2. ステークホルダー

### 2.1 プロジェクトオーナー

- **役割**: 企画・開発・運用
- **責任範囲**: システム全体の開発・保守・運用

### 2.2 エンドユーザー

| ユーザー層       | ニーズ                             | 想定利用シーン               |
| ---------------- | ---------------------------------- | ---------------------------- |
| 地元住民（一般） | 今日・週末のイベントを知りたい     | スマホで手軽にチェック       |
| 子育て世代       | 家族向け・無料のイベントを探したい | 週末の予定を立てる際に利用   |
| 高齢者           | 文化会館・公民館の催しを知りたい   | シンプルで見やすい表示を希望 |
| 観光客           | 期間限定イベントを知りたい         | 旅行計画時・滞在中の情報収集 |
| イベント主催者   | 人を集めたい、広く知らせたい       | 将来的な有料投稿機能の利用者 |

### 2.3 想定ユーザー規模

- **初期目標**: 20 人程度
- **将来目標**: 段階的に拡大

---

## 3. システム要件

### 3.1 機能要件

#### 3.1.1 データ収集機能（バックエンド）

**自動スクレイピング機能**

- **対象サイト数**: 22 サイト（飯田市および南信州エリア）
- **収集形式の内訳**:
  - リスト形式: 約 80%（17-18 サイト）
  - テーブル形式: 約 20%（4-5 サイト）
  - RSS 対応: 1 サイト
- **実行頻度**: 1 日 1 回（深夜帯を想定）
- **収集方法の優先順位**:
  1. RSS/フィード（対応サイトのみ）
  2. リスト形式の HTML 解析
  3. テーブル（table）形式の HTML 解析
  4. 将来的に PDF 解析（AI 活用）

**取得データ項目**

| 項目         | 必須/任意 | 形式       | 備考                     |
| ------------ | --------- | ---------- | ------------------------ |
| タイトル     | 必須      | テキスト   | イベント名称             |
| 開催日       | 必須      | YYYY-MM-DD | 日付形式に統一           |
| 詳細 URL     | 必須      | URL        | ソース元のリンク         |
| 開催場所     | 任意      | テキスト   | 取得可能な場合のみ       |
| 概要説明     | 任意      | テキスト   | 取得可能な場合のみ       |
| 画像 URL     | 任意      | URL        | チラシ・告知画像         |
| 取得元サイト | 必須      | テキスト   | どのサイトから取得したか |

**エラーハンドリング**

- スクレイピング失敗時のログ記録
- 重複データの自動判定（タイトル＋開催日＋取得元で判定）
- サイト構造変更の検知機能

#### 3.1.2 Web サイト機能（フロントエンド）

**イベント表示機能**

- 今日のイベント一覧
- 今週のイベント一覧
- 今月のイベント一覧
- カード型 UI での表示（タイトル、日時、場所、詳細リンク）

**フィルタリング機能**

- 地域別フィルター（市町村単位）
- 日付範囲指定
- キーワード検索（タイトル・概要から検索）

**詳細表示**

- イベント詳細ページ
- 元サイトへの外部リンク
- 画像表示（存在する場合）

**共有機能**

- LINE でシェア
- X（旧 Twitter）でシェア
- URL コピー機能

#### 3.1.3 LINE 通知機能

**LINE 公式アカウント**

- 専用の公式アカウントを新規作成
- 友だち追加でサービス利用開始

**通知設定**

- 通知タイプ: 新着イベントのみ
- 通知時間: 毎朝 8 時統一
- 地域フィルター: ユーザーが希望する地域のみ通知

**通知内容**

- 新着イベントのタイトル
- 開催日時
- 開催場所
- 詳細ページへのリンク
- 1 日最大 5 件まで（それ以上は「他 ○ 件」として省略）

#### 3.1.4 管理機能

**運用管理**

- スクレイピングログの確認
- エラーサイトの一覧表示
- 手動でのイベント追加（スクレイピング失敗時の補完）
- データベースの重複チェック状況

### 3.2 非機能要件

#### 3.2.1 パフォーマンス要件

- ページ読み込み時間: 3 秒以内
- 同時接続数: 50 ユーザー程度を想定
- データベース容量: 初期 1GB 程度

#### 3.2.2 可用性要件

- サービス稼働率: 95%以上
- メンテナンス時間: 深夜帯に実施

#### 3.2.3 セキュリティ要件

- HTTPS 通信の実装
- SQL インジェクション対策
- XSS 対策
- 個人情報は収集しない（LINE の ID のみ）

#### 3.2.4 ユーザビリティ要件

- モバイルファースト設計
- レスポンシブデザイン
- 高齢者にも見やすい文字サイズ
- シンプルで直感的な操作

#### 3.2.5 互換性要件

- 対応ブラウザ: Chrome、Safari、Edge（最新 2 バージョン）
- スマートフォン: iOS 14 以上、Android 10 以上
- PC: Windows 10 以上、macOS 10.15 以上

---

## 4. システム構成

### 4.1 技術スタック

| レイヤー       | 技術                                 | 選定理由                            |
| -------------- | ------------------------------------ | ----------------------------------- |
| フロントエンド | Next.js 15 (App Router) + TypeScript | 最新技術で SEO 対応、開発効率が高い |
| スタイリング   | Tailwind CSS                         | モダンでレスポンシブ対応が容易      |
| バックエンド   | Supabase Edge Functions              | サーバーレスで運用コスト削減        |
| データベース   | Supabase (PostgreSQL)                | 無料枠で十分、リアルタイム機能あり  |
| スクレイピング | Playwright/Cheerio                   | 動的・静的サイト両対応              |
| 定期実行       | Supabase Cron                        | 追加インフラ不要                    |
| ホスティング   | Vercel                               | Next.js との相性、無料枠あり        |
| LINE 連携      | LINE Messaging API                   | 公式 API 利用                       |

### 4.2 データベース設計

```sql
-- イベント情報テーブル
events {
  id: UUID (PK)
  title: TEXT NOT NULL
  event_date: DATE NOT NULL
  event_time: TEXT
  place: TEXT
  detail: TEXT
  source_url: TEXT NOT NULL
  source_site: TEXT NOT NULL
  region: TEXT DEFAULT '飯田市'
  image_url: TEXT
  is_new: BOOLEAN DEFAULT true
  created_at: TIMESTAMP
  updated_at: TIMESTAMP
}

-- スクレイピングログ
scraping_logs {
  id: UUID (PK)
  site_name: TEXT NOT NULL
  status: TEXT NOT NULL
  events_count: INTEGER
  error_message: TEXT
  created_at: TIMESTAMP
}

-- LINE通知設定（将来実装）
line_users {
  id: UUID (PK)
  line_user_id: TEXT UNIQUE
  regions: TEXT[]
  is_active: BOOLEAN DEFAULT true
  created_at: TIMESTAMP
}
```

---

## 5. 画面設計

### 5.1 画面一覧

| 画面名       | URL            | 説明                 |
| ------------ | -------------- | -------------------- |
| トップページ | /              | 今日のイベント一覧   |
| 週間イベント | /week          | 今週のイベント       |
| 月間イベント | /month         | 今月のイベント       |
| イベント詳細 | /event/[id]    | 個別イベントの詳細   |
| 地域別       | /region/[name] | 地域でフィルタリング |

### 5.2 UI 設計方針

- カード型デザインで視認性向上
- 無限スクロールまたはページネーション
- スマホでの操作を最優先
- 文字サイズは可変（アクセシビリティ対応）

---

## 6. 開発計画

### 6.1 フェーズ分け

#### Phase 1: 基盤構築（2-3 週間）

- [ ] データベース設計・構築
- [ ] スクレイピング機能の実装（22 サイト対応）
- [ ] エラーハンドリング実装
- [ ] 定期実行設定

#### Phase 2: Web UI 実装（1-2 週間）

- [ ] フロントエンド基本機能
- [ ] イベント一覧表示
- [ ] フィルタリング機能
- [ ] レスポンシブ対応

#### Phase 3: LINE 連携（1 週間）

- [ ] LINE 公式アカウント作成
- [ ] 通知機能実装
- [ ] ユーザー設定機能

#### Phase 4: 運用準備（1 週間）

- [ ] テスト実施
- [ ] 本番環境構築
- [ ] 運用ドキュメント作成

### 6.2 マイルストーン

- **M1**: スクレイピング機能完成（3 週間後）
- **M2**: Web 版リリース（5 週間後）
- **M3**: LINE 通知機能リリース（6 週間後）

---

## 7. リスクと対策

| リスク                   | 影響度 | 発生確率 | 対策                                             |
| ------------------------ | ------ | -------- | ------------------------------------------------ |
| サイト構造の変更         | 高     | 中       | 変更が少ないサイトを選定済み、ログ監視で早期発見 |
| スクレイピングの負荷     | 中     | 低       | 適切な間隔設定、robots.txt 遵守                  |
| ユーザー数が想定を超える | 低     | 低       | Supabase の無料枠で対応可、必要時は有料プランへ  |
| 個人情報の取り扱い       | 高     | 低       | LINE ID 以外は収集しない設計                     |

---

## 8. 制約事項

### 8.1 対象外機能（MVP では実装しない）

- AI による高度なデータ抽出
- PDF/画像からの OCR 抽出
- イベント主催者の投稿システム
- チケット販売・参加申込機能
- ユーザーレビュー機能
- カレンダー形式での表示
- イベントのカテゴリ自動分類

### 8.2 技術的制約

- PDF のみで情報提供しているサイトは対象外
- Facebook 等の SNS 限定イベントは取得対象外
- 動的に生成されるカレンダー形式は取得困難のため除外

---

## 9. 将来の拡張計画

### 9.1 Phase 5 以降の機能案

1. **有料投稿機能**

   - イベント主催者向け投稿システム
   - 料金体系の検討（月額/都度払い）

2. **AI 活用**

   - PDF からの情報抽出
   - イベントの自動カテゴリ分類
   - 類似イベントの推薦

3. **エリア拡大**

   - 南信州全域への拡張
   - 長野県全域への展開

4. **高度な通知機能**
   - ユーザーの興味に基づくレコメンド
   - プッシュ通知のパーソナライズ

---

## 10. 成功指標（KPI）

### 10.1 定量的指標

- LINE 友だち登録数: 20 人（3 ヶ月以内）
- 月間アクティブユーザー: 15 人以上
- イベント情報の網羅率: 22 サイトの 80%以上を自動取得

### 10.2 定性的指標

- ユーザーからのポジティブフィードバック
- 地域イベントの参加者増加（主催者からの声）
- 「探さなくていい」体験の実現

---

## 11. 運用・保守

### 11.1 日常運用

- スクレイピングログの確認（週 1 回）
- エラー発生時の手動対応
- ユーザーからの問い合わせ対応

### 11.2 保守作業

- セキュリティアップデート（月 1 回）
- パフォーマンス監視
- データベースのバックアップ（自動）

---

## 12. 承認事項

本要件定義書の内容で開発を進めることを承認します。

**承認日**: ****\_\_\_****
**承認者**: ****\_\_\_****

---

## 改訂履歴

| バージョン | 日付       | 改訂内容 | 作成者 |
| ---------- | ---------- | -------- | ------ |
| 1.0        | 2025/11/03 | 初版作成 | -      |
